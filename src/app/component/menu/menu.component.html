<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

<div class="mobile-container">

  <header class="header">
    <div class="search-bar">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input type="text" placeholder="Procurar" [(ngModel)]="searchQuery" (input)="onSearch()">
    </div>
    <div class="avatar-wrapper">
      <img src="images/avatar.png" alt="Avatar do UsuÃ¡rio" class="user-avatar" (click)="toggleMenu()">
      <div class="dropdown-menu" *ngIf="showMenu">
        <div class="dropdown-user-info">
          <i class="fa-solid fa-user-circle"></i>
          <span>{{getUserName()}}</span>
        </div>
        <div class="dropdown-divider"></div>
        <a routerLink="/cadastro-produto" class="dropdown-item">
          <i class="fa-solid fa-utensils"></i>
          <span>Cadastrar Produto</span>
        </a>
        <a routerLink="/excluir-produto" class="dropdown-item">
          <i class="fa-solid fa-trash"></i>
          <span>Excluir Produto</span>
        </a>
        <div class="dropdown-divider"></div>
        <a (click)="logout()" class="dropdown-item logout">
          <i class="fa-solid fa-right-from-bracket"></i>
          <span>Sair</span>
        </a>
      </div>
    </div>
  </header>

  <main>
    <nav class="categories">
      <ul>
        <li *ngFor="let category of categories"
            [class.active]="selectedCategory === category"
            (click)="selectCategory(category)">
          <div class="category-icon-wrapper">
            <img [src]="'images/' + category.toLowerCase() + '.png'" [alt]="category">
          </div>
          <span>{{category}}</span>
        </li>
      </ul>
    </nav>

    <section class="product-grid">
      <a [routerLink]="['/detalhe', product.id]" class="product-link" *ngFor="let product of filteredProducts">
        <article class="product-card">
          <button class="favorite-btn" (click)="toggleFavorite(product, $event)">
            <i [class]="isFavorite(product.id) ? 'fa-solid fa-heart' : 'fa-regular fa-heart'"></i>
          </button>
          <img [src]="product.image" [alt]="product.name">
          <div class="product-info">
            <h3>{{product.name}}</h3>
            <span class="price">R$ {{product.price.toFixed(2)}}</span>
            <div class="add-button" *ngIf="getItemQuantity(product.id) === 0" (click)="addToCart(product, $event)">
              <i class="fa-solid fa-circle-plus"></i>
            </div>
            <div class="quantity-selected" *ngIf="getItemQuantity(product.id) > 0">
              <i class="fa-solid fa-check"></i>
              <span>{{getItemQuantity(product.id)}}</span>
            </div>
          </div>
        </article>
      </a>
    </section>
  </main>

  <footer class="bottom-nav">
    <a routerLink="/menu" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-item"><i class="fa-solid fa-grip"></i></a>
    <a routerLink="/historico" routerLinkActive="active" class="nav-item"><i class="fa-solid fa-clock-rotate-left"></i></a>
    <a routerLink="/favoritos" routerLinkActive="active" class="nav-item"><i class="fa-regular fa-heart"></i></a>
    <a routerLink="/carrinho" class="nav-item cart" [class.active]="cartItemCount > 0">
      <i class="fa-solid fa-cart-shopping"></i>
      <span class="cart-count" *ngIf="cartItemCount > 0">{{cartItemCount}}</span>
    </a>
  </footer>

  <!-- Modal de logout -->
  <div class="modal-overlay" *ngIf="showLogoutModal" (click)="cancelarLogout()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-icon logout-icon">
        <i class="fa-solid fa-right-from-bracket"></i>
      </div>
      <h2>Sair da conta</h2>
      <p>Tem certeza que deseja sair da sua conta?</p>
      <div class="modal-actions">
        <button class="btn-cancel" (click)="cancelarLogout()">
          <i class="fa-solid fa-xmark"></i>
          Cancelar
        </button>
        <button class="btn-confirm" (click)="confirmarLogout()">
          <i class="fa-solid fa-check"></i>
          Sair
        </button>
      </div>
    </div>
  </div>

</div>
